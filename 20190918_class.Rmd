---
---

```{r setup, include=FALSE}

library(knitr)

opts_chunk$set(echo = TRUE, message = F, warning = F, eval=T)

```



```{r}

StuList <- list(
  次序=c(1,2,3,4,5,6,7,8),
  學號=c(172,214,322,425,517,833,752,114),
  姓名=c("小明","大雄","胖虎","小新","大白","阿華","小英","阿美"),
  性別=c("男","男","男","女","女","男","女","男"),
  成績=c(80,42,90,82,50,77,30,90)
  )
StuList
as.data.frame(StuList) -> StuDFfromList
StuDFfromList

```

```{r}

StuDF <- data.frame(
  次序=c(1,2,3,4,5,6,7,8),
  學號=c(172,214,322,425,517,833,752,114),
  姓名=c("小明","大雄","胖虎","小新","大白","阿華","小英","阿美"),
  性別=c("男","男","男","女","女","男","女","男"),
  成績=c(80,42,90,82,50,77,30,90)
  )
StuDF 

```

```{r}

class(StuDF)
typeof(StuDF)

```

```{r}

length(StuDF)
nrow(StuDF)

```

```{r}

library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)

```

## dplyr

```{r}

str(StuDF)

head(StuDF)
tail(StuDF)

```


```{r}

StuDF
slice(StuDF,1:3)
slice(StuDF,4:5)
slice(StuDF,n())

```



# mutate


```{r}
library(readr)
collegeData <- read_csv("https://raw.githubusercontent.com/tpemartin/github-data/master/103_student.csv")
```

```{r}

StuDF
mutate(StuDF,
       調分後成績=成績+10)
transmute(StuDF,
       調分後成績=成績+10) # 不保留其他變數

```


```{r}

mutate(collegeData,
       男生成績 = 一年級男生 + 二年級男生 + 三年級男生 + 四年級男生, 
       女生成績 = 一年級女生 + 二年級女生 + 三年級女生 + 四年級女生,
       男女生比 = 
       ) -> collegeData_2

```

```{r}

summarise(StuDF,
        平均成績=mean(成績),
        最高分=max(成績),
        最低分=min(成績))

```

```{r}

mutate(StuDF, 
       平均成績=mean(成績),
       最高分=max(成績), 
       最低分=min(成績), 
       調分後成績 = 成績 + (max(成績)-min(成績))/5
      ) -> StuDF_2

```

```{r}

names(StuDF_2)

select(StuDF_2, 
       姓名,學號,成績,調分後成績
       )

select(StuDF_2, 
       次序,性別,
       contains("最")
       )

```

# filter

```{r}

StuDF
# logical vector
logiChoose <- c(
  F,F,F,T,T,F,T,F
)
# 使用logical vector選擇所要觀測值"女"
StuDF[logiChoose,]

```
```{r}

logiChoose
which(logiChoose)

slice()


```

```{r}

# relational operators
StuDF$性別=="女" 
StuDF$成績>60


```


```{r}

# combined with logical operator
(StuDF$性別=="女" & StuDF$成績>60) -> logiChoose2
logiChoose2

StuDF[logiChoose2,]


```

```{r}



```



## group by

```{r}

group_by(StuDF,
         性別) -> StuDF_by性別



```
```{r}

# 使用grouped data frame
summarise(StuDF_by性別,
        平均成績=mean(成績),
        最高分=max(成績),
        最低分=min(成績))

# 使用ungrouped data frame
summarise(StuDF,
          平均成績=mean(成績),
          最高分=max(成績),
          最低分=min(成績)
         )
```

```{r}

group_by(collegeData,
         縣市名稱, 體系別, 等級別,  
         ) -> collegeData_by縣市and體系

summarise(collegeData_by縣市and體系, 
          一年級男生總數 = sum(一年級男生), 
          一年級女生總數 = sum(一年級女生), 
          學校數目 = n()
          )

```



