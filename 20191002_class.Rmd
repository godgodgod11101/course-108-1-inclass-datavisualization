---
title: "Aesthetic Scales"
author: "王正評"
date: "10/2/2019"
output: html_document
---

```{r setup, include=FALSE}

library(knitr)

opts_chunk$set(echo = TRUE, message = F, warning = F, eval=T)

```

```{r package, include=FALSE}

library(readr) #資料匯入
library(dplyr) #資料整理（slice、select、filter、mutate）
library(tidyr) #資料整理（gather、spread）
library(lubridate) #時間資料處理（ymd）
library(ggplot2) #作圖

library(grDevices) #不同色彩空間的十六進制代碼呈現（#598C73）
library(scales) #show_col()：螢幕立即顯示顏色

library(colorspace) #調色盤選擇及ggplot應用工具
library(shiny) #支援套件
library(shinyjs) #支援套件

```



# aesthetic scales


## color

RGB色彩空間

```{r rgb}

grDevices::rgb(0,0,1) #即對應顏色強度為(0, 0, 255)=0000FF（十六進制顏色代碼）

scales::show_col(
  c(
    rgb(0, 0, 1), 
    rgb(0, 1, 0), 
    rgb(1, 0, 0), 
    rgb(0.35, 0.55, 0.45)
  )
)

```

HSV色彩空間：

RGB色彩空間中的點在圓柱坐標系中的表示法（非線性轉換），讓選色較為直觀。

1. Hue（色像）: 以360度色環所要「角度/360」選擇基本色。
2. Saturation（飽合度）: 可以想成白色與所選擇基本色的混合比例，0＝全白色，1＝全基本色。
3. Value（lightness  value 照度）: 可以想成要在多亮的環境下看，0＝全暗，1＝全亮。

```{r hsv}

show_col(
  c(
    hsv(30/360,0,0), hsv(30/360,0.5,0), hsv(30/360,1,0),       #全暗
    hsv(30/360,0,0.5), hsv(30/360,0.5,0.5), hsv(30/360,1,0.5), #0.5
    hsv(30/360,0,1), hsv(30/360,0.5,1), hsv(30/360,1,1)        #全亮
  )
)
         #全白              0.5               全原色              

```

HCL色彩空間：

以人眼感受出發的色彩選擇。
每一種色像會有眼睛感觀的上下限，在不同色像下它的眼睛可感受C-L空間大小及位置會不同。

1. Hue（色像）: 以360度色環選擇基本色。
2. Chroma（彩度）: 彩度越低顏色感受越有陰影感。
3. Luminance（流明度）: 流明度越高代表在越亮的環境觀看。

```{r HCL, eval=FALSE}

#使用colorspace::choose_color()來協助色彩選擇

choose_color()

```

```{r}

show_col(
  c("#449F95", "#E8A298")
)

```



## palette（調色盤）

```{r palette, eval=FALSE}

choose_palette(gui="shiny")

choose_palette() #不好用

```

Qualitative：突顯不同類別

```{r palette 1}

god <- colorspace::qualitative_hcl(n = 8, h = c(0, 360), c = 35, l = 85, register = "godPalette_Qua")
       #複製R下的Register custom color palette程式碼
#取0 ~ 360度的8個不同色相，固定彩度與流明度

god %>%
  specplot(
    hcl = T
  ) # HCL spectrum is visualized. 

god %>%
  specplot(
    hcl = F
  )

```

Sequential：突顯不同類別有排序感

```{r}

god1 <- sequential_hcl(n = 7, h = 260, c = c(80, NA, NA), l = c(30, 90), power = 1.65, rev = TRUE, register = "godPalette_Se_single")
#單一色像，由淺到深（rev = TRUE），愈走愈快（power = 1.65，彩度、流明度皆有變化）

god1

god1 %>%
  specplot(
    hcl = F
  )

show_col(
  c(
     hcl(94, 0, 90), 
    hcl(260, 80, 30)
  )
)

```

Diverging: 突顯不同類別有排序感，且強調極端族群資料

```{r}

god2 <- diverging_hcl(n = 7, h = c(260, 0), c = 80, l = c(30, 90), power = 2.5, register = "godPalette_Div_1")

god2 %>%
  specplot(
    hcl = F
  )

show_col(
  c(
    hcl(260, 80, 30), 
    hcl(0, 80, 30)
  )
)

```


## ggplot應用

1. scale_color_...用來改變aes為color的顏色
2. scale_fill_...用來改變aes為fill的顏色

```{r sample}

sample(c(1L,2L,3L), 3, replace=T) #從integer 1 2 3 中採抽後放回方式取3個樣本
sample(letters[1:3], 3, replace=T) #從{a, b, c}中採抽後放回方式取3個樣本

g2 <- runif(10) #從[0,1]連續均一分配中隨機產生10個樣本

g3 <- rnorm(10) #從mean=0，sd=1常態分配中隨機產生10個樣本

g2
g3

```

```{r sample data}

data.frame(
  x1 = factor(sample(c(1L,2L,3L),100,replace=T)),
  x2 = runif(100), 
  y = runif(100),
  z1 = rnorm(100),
  z2 = factor(sample(letters[1:4],100,replace=T))
) -> df_example

df_example

```

```{r}

df_example %>%
  ggplot()+
  geom_boxplot(
    aes(x=x1,y=y,fill=z2)
  ) -> 
  godBoxplot

godBoxplot

```

套用調色盤：
1. 用colorspace套件裡的scale_...()函數
2. scale_< color、fill >_< color、fill的變數類型 >_< Qua、Seq、Div >

```{r}

godBoxplot +
  scale_fill_discrete_qualitative(palette="godPalette_Qua", nmax=5)
#由於色圈會由0度出發回到360度所以第1個及第5個會是同色，因此4類要創出5個顏色才不會有1,4類同色問題。

```

```{r}

df_example %>%
  ggplot() + 
  geom_point(
    aes(
      x = x2, 
      y = y, 
      color = z1
    )
  ) -> godScatterplot

godScatterplot
  

```

```{r}

godScatterplot + 
  scale_color_continuous_sequential(
    palette = "godPalette_Se_single"
  ) #不用給nmax

```

練習

```{r data wrangling}

transcriptEachYear <- read_csv("https://www.dropbox.com/s/hsuuedc7wyvq7n5/transcriptEachYear.csv?dl=1")

transcriptEachYear %>%
  spread(
    key = 年級, value = 學年平均成績
  ) ->
  transcriptEachYear_spread

```

```{r choose color}

colorspace::sequential_hcl(n = 10, h = c(240, 130), c = c(30, NA, 33), l = c(25, 95), power = c(1, NA), register = "godPalette_Se_single1") -> god3

show_col(
  god3
)

god3

```

```{r data visualization}

transcriptEachYear_spread %>%
  ggplot() +
  theme_classic() + 
#改底圖
  geom_point(
    aes(
      x = `1`, 
      y = `2`
    ), 
    color = "#D1FBD4", 
    alpha = 0.2
  ) + 
  geom_point(
    data = transcriptEachYear_spread %>% filter(學系=="社會學系"), 
    aes(
      x = `1`, 
      y = `2`
    ), 
    color = "#0E3F5C"
  ) + 
  labs(
    x = "一年級成績", 
    y = "二年級成績"
  )
#改title、X軸、Y軸名稱

```



