---
title: "每週一圖作業"
output: html_document
params:
  組員: ["王正評"]  
  學號: ["710761105"]
---

#### 環境設定

以下為老師執行時一定會存在的環境設定
```{r basic setup, message=FALSE, echo=TRUE, eval=T}
library(dplyr); library(stringr); library(ggplot2); library(plotly); library(lubridate); library(readr); library(tidyr); library(showtext)

font_add("QYuan","cwTeXQYuan-Medium.ttf") # 新增字體
showtext_auto(enable=TRUE) #啟用字體
theme_set(theme_classic())
knitr::opts_chunk$set(out.width='80%', fig.asp=.75, fig.align='center', fig.showtext=T)
```

#### 資料處理

此部份在做：

  * 原始Rda資料引入（即引入**dataList**物件）；
  
  * 資料清理成作圖用graphData物件。

請將你最原始的資料連同作業一起上傳到作業上傳網址：  
  * 若「原始資料為網頁下載」，且下載指令寫在data cleaning chunk裡的話，可以不用上傳「資料」。  
  * 若原始資料有很多個檔案，請先引入成data frame並存在「一個」.Rda檔裡上傳（如`example_data.Rda`檔）。  

資料檔引入到進入作圖前的資料處理請寫在下面區塊，分二部份：

  * 資料處理  
  * 作圖用資料物件生成(最後形成作圖資料物件graphData)
  
```{r data cleaning, echo=TRUE, eval=T}

smoke <- read_csv("https://drive.google.com/uc?export=download&confirm=jeak&id=1MX4lUwYiQhyNjRuMjyyonuzo6ekPJ1G6")

graphData <- list()

smoke %>%
  filter(
    類別 == "整體"
  ) %>%
  select(
    -類別
  ) %>%
  mutate(
    `依年度別分 by year` = str_c(`依年度別分 by year`, "01", "01")
  ) %>% 
  transmute(
    西元年 = ymd(`依年度別分 by year`), 
    男 = `男 Male (%)`, 
    女 = `女 Female (%)`
  ) %>% 
  gather(
    男, 女, 
    key = "性別", value = "吸菸率"
  ) -> 
  graphData$smoke_result

graphData$smoke_result

```

#### 繪圖程式

```{r graph, echo=T, eval=T}

library(scales)
library(colorspace)
library(shiny)
library(shinyjs)

graphData$smoke_result %>%
  ggplot(
    aes(
      x = 西元年, 
      y = 吸菸率, 
      color = 性別, 
      group = 性別
    )
  ) + 
  geom_line(size = 2) + 
  geom_point(
    data = graphData$smoke_result %>% 
      filter(
        year(西元年) %in% c(2004, 2010, 2016)
      ), 
    size = 3
  ) + 
  geom_text(
    data = graphData$smoke_result %>% 
      filter(
        year(西元年) %in% c(2004, 2010, 2016)
      ), 
    aes(
      label = str_c(round(吸菸率, 1), "%")
    ), 
    vjust = -0.8
  ) + 
  ylim(0, 50) + 
  labs(
    y = "吸菸率（％）", 
    title = "台灣18歲以上人口吸菸率", 
    subtitle = "2004～2016年"
  ) -> 
  godPlot
  
godPlot + 
  theme(
    plot.background = element_rect(fill = "#B76F39"), 
    panel.background = element_rect(fill = "#006E37"), 
    panel.grid.major=element_blank(), 
    panel.grid.minor=element_blank(),
    plot.title = element_text(face = "bold", hjust = 0.5, size = 15), 
    plot.subtitle = element_text(face = "bold", hjust = 0.5), 
    legend.background = element_rect(fill="#006E37", colour = "black"), 
    legend.position=c(0.9,0.8)
  ) + 
  scale_color_manual(
    values = c("#E24C80", "#FFFFFF"), 
    breaks = c("男", "女")
  )
  

```

#### 設計說明
說明想傳達的訊息（必要）及設計想法（非必要）。寫在***之後

*** 

「吸菸率」定義：18歲以上，從以前到現在吸菸累計超過100支，且最近30天內曾經使用菸品者之比率。

計算公式：
$$\frac{有效完訪吸菸人數}{有效完訪樣本人數} \times 100\%$$

由圖可看出：
<ol>
  <li>男、女性吸菸率皆有逐年遞減的趨勢</li>
  <li>女性吸菸率大幅低於男性</li>
</ol>

