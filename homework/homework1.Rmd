---
title: "每週一圖作業"
output: html_document
params:
  組員: ["王正評"]  
  學號: ["710761105"]
---

#### 環境設定

以下為老師執行時一定會存在的環境設定
```{r basic setup, message=FALSE, echo=TRUE, eval=T}
library(dplyr); library(stringr); library(ggplot2); library(plotly); library(lubridate); library(readr); library(tidyr); library(showtext)

font_add("QYuan","cwTeXQYuan-Medium.ttf") # 新增字體
showtext_auto(enable=TRUE) #啟用字體
theme_set(theme_classic())
knitr::opts_chunk$set(out.width='80%', fig.asp=.75, fig.align='center', fig.showtext=T)
```

#### 資料處理

此部份在做：

  * 原始Rda資料引入（即引入**dataList**物件）；
  
  * 資料清理成作圖用graphData物件。

請將你最原始的資料連同作業一起上傳到作業上傳網址：  
  * 若「原始資料為網頁下載」，且下載指令寫在data cleaning chunk裡的話，可以不用上傳「資料」。  
  * 若原始資料有很多個檔案，請先引入成data frame並存在「一個」.Rda檔裡上傳（如`example_data.Rda`檔）。  

資料檔引入到進入作圖前的資料處理請寫在下面區塊，分二部份：

  * 資料處理  
  * 作圖用資料物件生成(最後形成作圖資料物件graphData)
  
```{r data cleaning, echo=TRUE, eval=T}

Case_10_result <- read_csv("http://data.cec.gov.tw/%E5%85%A8%E5%9C%8B%E6%80%A7%E5%85%AC%E6%B0%91%E6%8A%95%E7%A5%A8%E8%A8%88%E7%A5%A8%E7%B5%90%E6%9E%9C/Case_10_result.csv")

graphData <- list()

Case_10_result %>%
  select(
    公投案編號, 
    縣市, 
    同意票數, 
    有效票數
  ) %>%
  slice(
    14:22
  ) %>%
  filter(
    有效票數 > 200000
  )  %>% 
  transmute(
    公投案編號, 
    六都 = as.factor(縣市), 
    同意票數 = as.integer(同意票數), 
    有效票數 = as.integer(有效票數), 
    `同意比例（同意票／有效票）` = 同意票數/有效票數, 
  ) ->
  Case_10_result1
 
Case_10_result1 %>% 
  mutate(
    六都 = factor(
      六都, 
      levels = c(
        "臺北市", "新北市", "桃園市", "臺中市", "臺南市", "高雄市"
      )
    )
  ) -> 
  graphData$Case_10_result

```

#### 繪圖程式

```{r graph, echo=T, eval=T}

library(scales)
library(colorspace)
library(shiny)
library(shinyjs)

qualitative_hcl(n = 6, h = c(180, 360), c = 50, l = 80, register = "god-Palette-Qualitative1")

graphData$Case_10_result %>% 
  ggplot(
    aes(
      x = 六都, 
      y = `同意比例（同意票／有效票）`
    )
  ) + 
  geom_col(
    aes(
      fill = 六都, 
      width = 0.5
    )
  ) + 
  coord_flip() + 
   scale_y_continuous(
    limits = c(0, 0.8), 
    labels = percent_format()
  ) + 
  labs(
    title = "你是否同意民法婚姻規定應限定在一男一女的結合 ?"
  ) + 
  scale_fill_discrete_qualitative(
    palette = "god-Palette-Qualitative1", 
    nmax = 6
  ) + 
  geom_text(
    aes(
      label = str_c(
        round(`同意比例（同意票／有效票）`*100, 1), 
        "%"
      )
    ), 
    size = 10
  ) + 
  theme(
    plot.title = element_text(
      colour = "black", face = "bold", 
      size = 35 
    ), 
    axis.title.x = element_text(face = "bold", size = 25), 
    axis.title.y = element_text(face = "bold", size = 25), 
    axis.text.x = element_text(size = 20), 
    axis.text.y = element_text(size = 20), 
    legend.position = "none"
  )

```

#### 設計說明
說明想傳達的訊息（必要）及設計想法（非必要）。寫在***之後

*** 
公投案第10案：你是否**同意**民法婚姻規定**應限定在一男一女**的結合？

<ol>
  <li>六都的同意比例皆超過5成，顯示台灣社會對於性別的觀念仍趨保守。</li>
  <li>可看出雙北對於性別的觀念較其他四都開放，臺北市的同意比例甚至掉到7成以下。</li>
  <li>可看出愈往北部，性別觀念有愈趨成熟的趨勢。</li>
</ol>

