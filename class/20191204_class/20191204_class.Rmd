---
title: "Web application"
author: "jacky wang"
date: "2019/12/4"
output: html_document
---

```{r setup, include=FALSE}

library(knitr)

opts_chunk$set(echo = TRUE, message = F, warning = F, eval=T)

# windows檔名不要有"-"號

```

```{r package, include=FALSE}

library(readr) #資料匯入
library(dplyr) #資料整理（slice、select、filter、mutate）
library(tidyr) #資料整理（gather、spread）
library(stringr) #處理字串
library(lubridate) #時間資料處理（ymd）
library(ggplot2) #作圖
library(magrittr) # %<>%
library(showtext) #從字型檔讀取字型，並在繪圖時使用

library(grDevices) #不同色彩空間的十六進制代碼呈現（#598C73）
library(scales) #show_col()：螢幕立即顯示顏色
library(colorspace) #調色盤選擇及ggplot應用工具
library(shiny) #支援套件
library(shinyjs) #支援套件

library(sf)
library(osmdata)
library(plotly)
#source(file = "D:/Users/User/Documents/GitHub/Rfunction/osmGeomRename.R")

```



# Webpage

Documents generally contain three major parts:

  .html, .css, .js

  .css and .js files, and even other parts, can be contained within .html, 
  so that the html document is self-contained.
  
self_contained: true：knitr後只會生成一個html檔（default）。

self_contained: false
lib_dir: "檔案夾名稱"：knitr後會生成多個檔，並存在於自動生成的資料夾下。


## Bootstrap

Bootstrap是一組用於網站和網路應用程式開發的前端開發框架

eg. 

<div class="alert alert-success" role="alert">
  A simple success alert—check it out!
</div>
<div class="alert alert-danger" role="alert">
  A simple danger alert—check it out!
</div>
<div class="alert alert-warning" role="alert">
  A simple warning alert—check it out!
</div>
<div class="alert alert-info" role="alert">
  A simple info alert—check it out!
</div>

## save as .svg

```{r}

load(url("https://www.dropbox.com/s/r21jg0vxf77geu9/plot_tree.Rda?dl=1"))

plot_tree

#ggsave(plot_tree, filename = "plot_tree.svg")

```

## htmlwidget

htmlwidget是指可以幫我們把R output生成網頁動態效果所需之組合語法（svg、js、html）的套件，
如plotly、leaflet等。

流程：
    R繪圖套件（ggplot2、plotly） －＞ R圖形物件 －＞ htmlwidgets

因此我們需要一個可以完成R圖形物件轉htmlwidgets的功具。

課堂使用方式：
    plotly::ggplotly()：直接將設計好的ggplot物件轉成htmlwidgets（但可能有些設計會失效，要進一步微調）。

## plotly

```{r}

source("https://www.dropbox.com/s/wlv1ssxqq6n4p7u/gg_hw5_004.R?dl=1", encoding = "utf-8")

```

```{r}

gg_hw5_004


gg_hw5_004 %>%
  ggplotly() ->
  pltly_hw5_004

pltly_hw5_004

#有些設計跑掉了

```

```{r}

#file.create(".Rprofile") #在目前寫程式的目錄下創立一個檔名為.Rprofile的檔案
#file.edit(".Rprofile") #編輯它

# 需要建立R project

```

在 .Rprofile 內存以下兩行指令：
Sys.setenv("plotly_username"="各位的plotly平台使用者名稱")
Sys.setenv("plotly_api_key"="各位的API key的那一串英文與數字")

以後打開此project，那兩行會自動執行。

```{r}

# 確認.Rprofile有啟動

Sys.getenv("plotly_username")
Sys.getenv("plotly_api_key")

# 若沒有

#source(".Rprofile") 需在目前寫程式的目錄下

```

### 上傳修改

使用 api_create() 上傳plotly物件到plotly online editor，並進行修改

```{r}

api_create(
  pltly_hw5_004, 
  filename = "godhw5", 
  fileopt = "overwrite"      # 要覆蓋之前的檔案
)

```

1. Chart Studio -> My Files -> Edit
2. 在structure下找trace
3. 在style下的同一個trace裡做修改

```{r}

pltly_godhw5 <- api_download_plot(
  "5",             # view -> https://.../~godgodgod11101/5
  "godgodgod11101"
)

pltly_godhw5

#save(pltly_godhw5, file = "dashboard.Rda")  # 存成Rda檔供flexdashboard用

```

### Hover text

JS events: 
  (event) onmouseover  (description) The user moves the mouse over an HTML element


hover: 徘徊

```{r}

p <- ggplot(
  mtcars, 
  aes(x = wt, y = mpg)
) + 
  geom_point() + 
  geom_smooth()

pltly_p0 <- ggplotly(p)

pltly_p0

```

```{r}

pltly_p0 %>% 
  plotly_json()

```

```{r}

pltly_p0 %>% 
  style(
    traces = 2:3, 
    hoverinfo = "none" ### 不顯示
  ) 

pltly_p0 %>% 
  style(
    traces = 1,
    hoverinfo = "x"  # 顯示x的座標值
  )  
 

pltly_p0 %>% 
  style(
    traces = 1,
    hoverinfo = "x+y"  ### 顯示x和y的座標值（+：和）
  )  

```

```{r}

mtcars

pltly_p0 %>% 
  style(
    traces = 1, 
    hovertext = mtcars %>% rownames  # hover內容設定
  ) %>% 
  style(
    traces = 2:3, 
    hoverinfo = "none"
  )

```




